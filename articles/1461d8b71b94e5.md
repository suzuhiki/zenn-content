---
title: "Notionã®DBã®ãƒšãƒ¼ã‚¸æ•°ã‚’github actionsã§å®šæœŸçš„ã«ç›£è¦–ã—Notionã§å¯è¦–åŒ–ã™ã‚‹"
emoji: "ğŸ’¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["notion", "github", "actions", "golang"]
published: false
---

# ã¯ã˜ã‚ã«

ç­†è€…ã¯æ—¥é ƒã‹ã‚‰å€‹äººã§notionã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
æœ¬è¨˜äº‹ã¯ã€notionã«è¨˜è¼‰ã—ãŸçŸ¥è­˜ã®é‡ã‚’æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ãƒšãƒ¼ã‚¸æ•°ã®å¯è¦–åŒ–ã«å–ã‚Šçµ„ã‚“ã è¨˜éŒ²ã§ã™ã€‚


![å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸](/images/notion_database_count_preview.png)
*å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸*

:::message alert
notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½ã‚’ãƒ•ãƒ«ã§æ´»ç”¨ã—ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¦ç´ æ•°åˆ¶é™ãŒã‚ã‚‹ãŸã‚ã€ãƒ—ãƒ©ã‚¹ãƒ—ãƒ©ãƒ³ä»¥ä¸Šã‚’æ¨å¥¨ã—ã¾ã™ã€‚
:::

:::message
goè¨€èªã‚„githubã«é–¢ã™ã‚‹åŸºç¤çŸ¥è­˜ã«ã¤ã„ã¦ã¯ç´°ã‹ãèª¬æ˜ã—ã¾ã›ã‚“ã€‚
:::

å‰æã¨ã—ã¦ç­†è€…ã®notionã®é‹ç”¨ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¾ã™ã€‚
ã‚‚ã¨ã‚‚ã¨Scrapboxã¨ã„ã†ã€ãƒšãƒ¼ã‚¸åŒå£«ã‚’ãƒªãƒ³ã‚¯ã‚’ç”¨ã„ã¦é–¢é€£ä»˜ã‘ã‚‹ãƒ¡ãƒ¢ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ã„ãŸãŸã‚ã€Notionã§ã‚‚ãã‚Œã«ä¼¼ãŸé‹ç”¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚
æµ…ã„éšå±¤ã«ã„ãã¤ã‹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹(ä»¥ä¸‹ï¼šDB)ã‚’ä½œæˆã—ã€ãã®è¦ç´ ã¨ã—ã¦ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ã„ãé‹ç”¨ã‚’ã—ã¦ã„ã¾ã™ã€‚
```js
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ§‹é€ 
suzuhiki-memo
|- è¨˜éŒ²DB - ãƒšãƒ¼ã‚¸
|- èªå½™DB - ãƒšãƒ¼ã‚¸
|- ä½œå“DB - ãƒšãƒ¼ã‚¸
ï¸™
```

ã“ã®æ§‹é€ ã®notionãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å¯¾è±¡ã«ã€å„DBã®ãƒšãƒ¼ã‚¸æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã€ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤ºç”¨ã®DBã«æ›¸ãè¾¼ã¿ã€ãã‚Œã‚’notionä¸Šã§å¯è¦–åŒ–ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¾ã™ã€‚

# ä½œæ¥­
å¯è¦–åŒ–ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯å¤§ãã4ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ã€‚

1. Notionã®APIã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
2. å¯¾è±¡ã¨ã™ã‚‹DBã‹ã‚‰DBã®è¦ç´ æ•°ã‚’å–å¾—ã—ã¦ã€å¯è¦–åŒ–ç”¨ã®DBã«ä¿å­˜ã™ã‚‹
3. Github Actionsã‚’ç”¨ã„ã¦å®šæœŸå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
4. Notionã®ãƒãƒ£ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¦å¯è¦–åŒ–

ä»¥ä¸‹ã§ãã‚Œãã‚Œã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## 1. Notionã®APIã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦Notion APIã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»Šå›ã¯å‹‰å¼·ã‚‚å…¼ã­ã¦Goè¨€èªã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
https://go.dev/doc/install

ç­†è€…ã¯Macã®homebrewã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
https://zenn.dev/y16ra/articles/251c3770365689

notion-db-counterã¨ã„ã†ãƒªãƒã‚¸ãƒˆãƒªã‚’githubã«ä½œæˆã—ã€`git clone`ã§ãƒ­ãƒ¼ã‚«ãƒ«ã«æŒã£ã¦ãã¾ã™ã€‚

cloneã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆã«ç§»å‹•ã—`go mod init`ã‹ã‚‰goè¨€èªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
```
go mod init notion-db-counter
```

ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã™ã‚‹`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã®é››å½¢(`.env.template`)ã‚’ä½œæˆã—ã¾ã™ã€‚
```sh:.env.template
# please run source .env
export NOTION_TOKEN=<YOUR_NOTION_TOKEN>
export WRITE_DB_ID=<YOUR_WRITE_DB_ID>
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€åå‰ã‚’`.env`ã«ã—ã¾ã™ã€‚
githubã«ç’°å¢ƒå¤‰æ•°ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œãªã„ã‚ˆã†ã«ã€`.gitignore`ã«`.env`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

### Notion Tokenã®å–å¾—
https://www.notion.com/ja/help/create-integrations-with-the-notion-api#%E5%86%85%E9%83%A8%E3%82%A4%E3%83%B3%E3%83%86%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90
ä¸Šè¨˜è¨˜äº‹ã«ã—ãŸãŒã£ã¦ã€ä»»æ„ã®åå‰ã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

å†…éƒ¨ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®é …ç›®ã«ã‚ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã€`.env`ã®`<YOUR_NOTION_TOKEN>`ã®éƒ¨åˆ†ã«è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

æ¨©é™ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚
![notionã®æ¨©é™è¨­å®š](/images/notion_integration_setting.png)

å¿˜ã‚Œãšã«notionãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ãƒšãƒ¼ã‚¸ã«ã“ã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¥ç¶šã—ã¦ãŠãã¾ã™ã€‚
å¯¾è±¡ã¨ãªã‚‹å…¨ã¦ã®DBã‚ˆã‚Šéšå±¤ãŒä¸Š(è¦ª)ã§ã‚ã‚‹ãƒšãƒ¼ã‚¸ã§å³ä¸Šã®`â€¦`ãƒœã‚¿ãƒ³ã‹ã‚‰æ¥ç¶šã‚’é¸æŠã—ã€å…ˆç¨‹ä½œæˆã—ãŸã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
![ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¥ç¶š](/images/notion_integration_new_add.png =200x)



## 2. å¯¾è±¡ã¨ã™ã‚‹DBã‹ã‚‰DBã®è¦ç´ æ•°ã‚’å–å¾—ã—ã¦ã€å¯è¦–åŒ–ç”¨ã®DBã«ä¿å­˜ã™ã‚‹

### å¯è¦–åŒ–ç”¨DBã‚’ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã™ã‚‹
å…ˆã»ã©ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ãŸãƒšãƒ¼ã‚¸ã‚ˆã‚Šä¸‹ã®éšå±¤ã«å¯è¦–åŒ–ç”¨ã®å¯è¦–åŒ–DBã‚’ä½œæˆã—ã¾ã™ã€‚
DBã®åå‰ã¯ä½•ã§ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚

ç›®æ¨™ã¨ã™ã‚‹DBæ§‹é€ ã¯ä»¥ä¸‹ã®å›³ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã«å¾“ã£ã¦ã€titleã€dateã€labelã€lengthã®ã‚«ãƒ©ãƒ ã‚’æŒã¤ã‚ˆã†ã«å¯è¦–åŒ–DBã‚’ç·¨é›†ã—ã¦ä¸‹ã•ã„ã€‚
![ç›®æ¨™ã¨ã™ã‚‹DBæ§‹é€ ](/images/notion_db_activity.png)
*ç›®æ¨™ã¨ã™ã‚‹DBæ§‹é€ *

å¯è¦–åŒ–DBã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã‚’URLã‹ã‚‰å–å¾—ã—ã€`.env`ã®`<YOUR_WRITE_DB_ID>`ã«ç™»éŒ²ã—ã¦ä¸‹ã•ã„ã€‚
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã¯URLã«ä»¥ä¸‹ã®ã‚ˆã†ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
```
https://www.notion.so/<ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ID>?...
```

### å¯è¦–åŒ–å¯¾è±¡ã®DBã‚’csvãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã™ã‚‹
ç›£è¦–å¯¾è±¡ã®DBã‚’csvãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢ã§è¨˜è¼‰ã—ã¾ã™ã€‚
`db_ids.csv`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œæˆã—ã¦ãã ã•ã„ã€‚
```csv
db_name, db_id
è¨˜éŒ²DB,<db id>
èªå½™DB,<db id>
æ¥½æ›²DB,<db id>
ä½œå“DB,<db id>
```
db_nameã¯å¯è¦–åŒ–ã®éš›ã«ã€ãƒ©ãƒ™ãƒ«åã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚
db_idã¯å…ˆç¨‹ã®å¯è¦–åŒ–DBã¨åŒã˜ã‚ˆã†ã«å–å¾—ã—ã¦è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚

ãªãŠã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¯ä»¥ä¸‹ã®å›³ã®é€šã‚Šã¨ãªã‚Šã¾ã™ã€‚
![ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](/images/notion-db-counter-directry.png =200x)

### APIã‚’åˆ©ç”¨ã™ã‚‹golangã®ã‚³ãƒ¼ãƒ‰ã‚’ç”¨æ„ã™ã‚‹
ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
è©³ç´°ã«ã¯èª¬æ˜ã—ã¾ã›ã‚“ã€‚

```go:main.go
package main

import (
	"bytes"
	"encoding/csv"
	"encoding/json"
	"fmt"
	"io"
	"net/http"
	"os"
	"time"
)

func main() {
	db_ids := map[string]string{}
	db_id_data, err := readCSV("db_ids.csv")
	if err != nil {
		fmt.Println("Error reading db_ids.csv:", err)
		os.Exit(1)
	}
	for i, record := range db_id_data {
		if i == 0 {
			// ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—
			continue
		}

		// record[0] is db_name, record[1] is db_id
		db_ids[record[0]] = record[1]
	}
	fmt.Println("Database IDs loaded")
	fmt.Println(db_ids)

	notion_token := os.Getenv("NOTION_TOKEN")
	if notion_token == "" {
		fmt.Println("Error: NOTION_TOKEN environment variable is not set")
		os.Exit(1)
	}
	fmt.Println("Notion token loaded")

	db_name_data_counts := map[string]int{}
	for db_name, db_id := range db_ids {
		start_cursor := ""
		data_counts := 0
		for true {
			// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ
			url := fmt.Sprintf("https://api.notion.com/v1/databases/%s/query", db_id)
			var body []byte
			if start_cursor != "" {
				body = []byte(fmt.Sprintf(`{"start_cursor": "%s"}`, start_cursor))
			}
			req, _ := http.NewRequest("POST", url, bytes.NewBuffer(body))
			req.Header.Set("Authorization", "Bearer "+notion_token)
			req.Header.Set("Notion-Version", "2022-06-28")
			req.Header.Set("Content-Type", "application/json")

			client := &http.Client{}
			resp, err := client.Do(req)
			if err != nil {
				fmt.Printf("Error sending request for %s: %v\n", db_name, err)
				break
			}
			defer resp.Body.Close()

			// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®èª­ã¿å–ã‚Š
			response, err := io.ReadAll(resp.Body)
			if err != nil {
				fmt.Printf("Error reading response for %s: %v\n", db_name, err)
				os.Exit(1)
			}

			// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹
			var responseData map[string]interface{}
			err = json.Unmarshal(response, &responseData)
			if err != nil {
				fmt.Printf("Error parsing response for %s: %v\n", db_name, err)
				os.Exit(1)
			}

			// ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒã‚§ãƒƒã‚¯
			if status, ok := responseData["status"].(float64); ok && status != 200 {
				message, _ := responseData["message"].(string)
				fmt.Printf("Error: API request failed for %s\nStatus: %v\nMessage: %s\n", db_name, status, message)
				os.Exit(1)
			}

			// resultsã®é•·ã•ã‚’data_countsã«åŠ ç®—
			if results, ok := responseData["results"].([]interface{}); ok {
				data_counts += len(results)
			}

			// start_cursorã®å‡¦ç†
			if has_more, ok := responseData["has_more"].(bool); ok && has_more {
				start_cursor = responseData["next_cursor"].(string)
				fmt.Println("DB name:", db_name, "Next cursor:", start_cursor)
			} else {
				db_name_data_counts[db_name] = data_counts
				fmt.Println("DB name:", db_name, "No next cursor break")
				break
			}
		}
	}

	fmt.Println("DB data counts fetched:", db_name_data_counts)

	// ãƒ‡ãƒ¼ã‚¿ã‚’notionãƒšãƒ¼ã‚¸ã«æ›¸ãè¾¼ã¿
	write_db_id := os.Getenv("WRITE_DB_ID")
	if write_db_id == "" {
		fmt.Println("Error: WRITE_DB_ID environment variable is not set")
		os.Exit(1)
	}

	fmt.Println("Writing to Notion...")

	for db_name, data_counts := range db_name_data_counts {
		// ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—
		currentDate := time.Now().Format("2006-01-02")

		// ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ä½œæˆ
		body := fmt.Sprintf(`{
			"parent": { "database_id": "%s" },
			"properties": {
				"title": {
					"title": [
						{
							"text": {
								"content": ""
							}
						}
					]
				},
				"label": {
					"rich_text": [
						{
							"text": {
								"content": "%s"
							}
						}
					]
				},
				"length": { "number": %d },
				"date": {"date": {"start": "%s"}}
			}
		}`, write_db_id, db_name, data_counts, currentDate)

		// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ
		url := "https://api.notion.com/v1/pages"
		req, _ := http.NewRequest("POST", url, bytes.NewBuffer([]byte(body)))
		req.Header.Set("Authorization", "Bearer "+notion_token)
		req.Header.Set("Notion-Version", "2022-06-28")
		req.Header.Set("Content-Type", "application/json")

		// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡
		client := &http.Client{}
		resp, err := client.Do(req)
		if err != nil {
			fmt.Printf("Error sending request for %s: %v\n", db_name, err)
			os.Exit(1)
		}
		defer resp.Body.Close()

		// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®èª­ã¿å–ã‚Š
		response, err := io.ReadAll(resp.Body)
		if err != nil {
			fmt.Printf("Error reading response for %s: %v\n", db_name, err)
			os.Exit(1)
		}

		// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹
		var responseData map[string]interface{}
		err = json.Unmarshal(response, &responseData)
		if err != nil {
			fmt.Printf("Error parsing response for %s: %v\n", db_name, err)
			os.Exit(1)
		}

		// ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒã‚§ãƒƒã‚¯
		if status, ok := responseData["status"].(float64); ok && status != 200 {
			message, _ := responseData["message"].(string)
			fmt.Printf("Error: API request failed for %s\nStatus: %v\nMessage: %s\n", db_name, status, message)
			os.Exit(1)
		}

		fmt.Printf("Successfully created page for %s\n", db_name)
	}
}

func readCSV(filePath string) ([][]string, error) {
	file, err := os.Open(filePath)
	if err != nil {
		return nil, err
	}
	defer file.Close()

	reader := csv.NewReader(file)
	records, err := reader.ReadAll()
	if err != nil {
		return nil, err
	}

	return records, nil
}

```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’terminalã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚
å¯è¦–åŒ–ç”¨DBã«è¦ç´ ãŒè¿½åŠ ã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚
```sh
source .env #ç’°å¢ƒå¤‰æ•°ã®é©ç”¨
go run main.go
```

å®Ÿè¡ŒãŒç¢ºèªã§ãã‚Œã°`commit`ã—ã¦`push`ã—ã¦ãã ã•ã„ã€‚

## 3. Github Actionsã‚’ç”¨ã„ã¦å®šæœŸå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
2ã§ä½œã£ãŸã‚³ãƒ¼ãƒ‰ã‚’å®šæœŸå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
ä»Šå›ã¯Github Actionsã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

`notion-db-counter/.github/workflows/notion.yml`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

```yml:notion.yml
name: Run Notion DB counts

on:
  schedule:
    - cron: '0 20 * * *'    # å®šæœŸå®Ÿè¡Œã®è¨­å®š(æ¯æœ5:00)
  workflow_dispatch:        # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½ã«ã™ã‚‹

jobs:
  run-go:
    runs-on: ubuntu-latest
    environment: actions

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.24'

      - name: Run Go script
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          WRITE_DB_ID: ${{ secrets.WRITE_DB_ID }}
        run: go run main.go
```

### ç’°å¢ƒå¤‰æ•°ã®githubã¸ã®ç™»éŒ²
`.env`ã«è¨˜è¼‰ã—ãŸç’°å¢ƒå¤‰æ•°ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ã¿åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€github actionsã«ã¯åˆ¥ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã€Environment Secretã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
https://qiita.com/ak2ie/items/4fbcdf74e7760c49c1af
:::message
ç’°å¢ƒå¤‰æ•°ã®åå‰ã¯actionsã¨ã—ã€`.env`ã«è¨˜è¼‰ã—ã¦ã„ãŸ2ã¤ã®ç’°å¢ƒå¤‰æ•°ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚
:::

![githubã®ç’°å¢ƒå¤‰æ•°ã®è¨­å®šç”»é¢](/images/github_env_name.png =450x)
![githubã®ç’°å¢ƒå¤‰æ•°ã®è¨­å®šç”»é¢](/images/github_env_value.png =450x)

ã“ã®çŠ¶æ…‹ã§githubã®Actionsã‚¿ãƒ–ã‚ˆã‚Šæ‰‹å‹•ã§å®Ÿè¡Œã§ãã¾ã™ã€‚
å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºãšã€Actionsã®ç”»é¢ã«âœ…ãŒè¡¨ç¤ºã•ã‚Œã€notionã®å¯è¦–åŒ–DBã«ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚

![githubActionsã®ç”»é¢](/images/github_actions_page.png =450x)

## 4. Notionã®ãƒãƒ£ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¦å¯è¦–åŒ–
Notionã®DBã®è¡¨ç¤ºå½¢å¼ã®ä¸€ã¤ã§ã‚ã‚‹ã€ãƒãƒ£ãƒ¼ãƒˆã‚’åˆ©ç”¨ã—ã¦å¯è¦–åŒ–ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«æ–°ã—ã„ãƒãƒ£ãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
![ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆ](/images/notion_chart.png =400x)


ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ã¨æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã¨ã—ã¦DBå†…ã®ãƒšãƒ¼ã‚¸æ•°ã®å¤‰åŒ–ã‚’è¨˜éŒ²ã§ãã¾ã™ã€‚
![ãƒãƒ£ãƒ¼ãƒˆã®è¨­å®š](/images/notion_chart_setting.png =200x)
*ãƒãƒ£ãƒ¼ãƒˆã®è¨­å®š*
![ãƒãƒ£ãƒ¼ãƒˆè¨­å®šã®ã€Œãã®ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€](/images/notion_chart_detail_setting.png =200x)
*ãƒãƒ£ãƒ¼ãƒˆè¨­å®šã®ã€Œãã®ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€*


# ãŠã‚ã‚Šã«
Notionã®DBã®è¦ç´ æ•°ã‚’Notionã®ãƒãƒ£ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ç”¨ã„ã¦å¯è¦–åŒ–ã™ã‚‹è©¦ã¿ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
ä»Šå›ã¯Notion APIã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ã®ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¾ã—ãŸãŒã€æ¤œç´¢é–¢é€£ã®API (api.notion.com/v1/search) ãªã©ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã‚ˆã‚ŠæŸ”è»Ÿãªå¯è¦–åŒ–ãŒå¯èƒ½ã ã¨æ€ã„ã¾ã™ã€‚

https://developers.notion.com/reference/intro

ã¿ãªã•ã‚“ã®ãŠå½¹ã«ç«‹ã¦ã‚Œã°å¹¸ã„ã§ã™ã€‚